<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESD Airline</title>
    <!-- load stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
    <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css"> <!-- Font Awesome -->
    <link rel="stylesheet" href="../public/css/bootstrap.min.css"> <!-- Bootstrap style -->
    <link rel="stylesheet" type="text/css" href="../public/css/datepicker.css" />
    <link rel="stylesheet" href="../public/css/templatemo-style.css"> <!-- Templatemo style -->
    <link rel="stylesheet" href="../public/css/bookingform.css">
    <link rel="stylesheet" href=" https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css">
    <!-- Bootstrap style -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <meta name = "google-signin-client_id" content="648525575446-vn5s4huqmidti2blbgbg0emnb0ml7887.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="../public/js/paymentprocess.js"></script>
</head>

<body onload="showPayment()">
    <div class="tm-main-content" id="top">
        <div class="tm-top-bar-bg"></div>
        <div class="tm-top-bar" id="tm-top-bar">
            <div class="container">
                <div class="row">
                    <nav class="navbar navbar-expand-lg narbar-light">
                        <a class="navbar-brand mr-auto" href="../public/index.html">
                            <img src="../public/img/logo.png" alt="Site logo">
                            ESD Airline
                        </a>
                        <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse"
                            data-target="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                            <ul class="navbar-nav ml-auto">
                                <li class="nav-item">
                                    <a class="nav-link" href="../public/index.html">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="../public/mybooking.html">My booking</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Recommended Places</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Contact Us</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id = "gbutton"><div class="g-signin2" data-onsuccess="onSignIn"></div></a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="emailTxt"></a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div> <!-- row -->
            </div> <!-- container -->
        </div> <!-- .tm-top-bar -->


<!-- ---payment--- -->
<div class="container d-lg-flex mt-5">
<div class="box-3">
    <div class="box-inner-2">
        <div>
            <p class="fw-bold">Make a Payment</p>
            <p class="dis mb-3">Your booking is only confirmed upon payment</p>
        </div>
        <form action="">

            <div>
                <p class="dis fw-bold mb-2">Card details</p>
                <div class="d-flex align-items-center justify-content-between card-atm border rounded">
                    <div class="fab fa-cc-visa ps-3"></div> <input type="text" class="form-control"
                        placeholder="Card Details">
                    <div class="d-flex w-50"> <input type="text" class="form-control px-0"
                            placeholder="MM/YY"> <input type="password" maxlength=3
                            class="form-control px-0" placeholder="CVV"> </div>
                </div>
                <div class="my-3 cardname">
                    <p class="dis fw-bold mb-2">Cardholder name</p> <input class="form-control" type="text">
                </div>
                <div class="address">
                    <p class="dis fw-bold mb-3">Billing address</p> <select class="form-select"
                        aria-label="Default select example">
                        <option selected hidden>Singapore</option>
                        <option value="1">United States</option>
                        <option value="2">India</option>
                        <option value="3">Australia</option>
                        <option value="4">Canada</option>
                    </select>
                    <div class="d-flex"> <input class="form-control zip" type="text" placeholder="ZIP">
                        <input class="form-control state" type="text" placeholder="Details">
                    </div>

                    <div class="d-flex flex-column dis">
                        
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <p class="fw-bold">Total</p>
                            <p id="price" class="fw-bold"><span class="fas fa-dollar-sign" ></span>253.00</p>
                        </div>
                        <p id="email" style="display: none"></p>
                        <!-- change this -->
                        <div id="smart-button-container">
                            <div style="text-align: center;">
                              <div id="paypal-button-container"></div>
                            </div>
                          </div>
                        <script src="https://www.paypal.com/sdk/js?client-id=sb&enable-funding=venmo&currency=USD" data-sdk-integration-source="button-factory"></script>
                        <!-- -- -->
                    </div>


                </div>
            </div>
        </form>
    </div>
</div>
</div>


<footer class="tm-container-outer">
    <p class="mb-0">Done by ESD Team 7</p>
</footer>
</div>
<script>
$(window).on("scroll", function () {
    if ($(window).scrollTop() > 100) {
        $(".tm-top-bar").addClass("active");
    } else {
        $(".tm-top-bar").removeClass("active");
    }
});

function onSignIn(googleUser) {
    var profile = googleUser.getBasicProfile();
    console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
    console.log('Name: ' + profile.getName());
    console.log('Image URL: ' + profile.getImageUrl());
    console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.

    var element = document.querySelector('#gbutton')
    element.innerHTML = '<a href = "payment.html" onclick="signOut()">Sign out</a>';

    var emailTxt= document.getElementById('emailTxt');
    }

    function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
            console.log('User signed out.');
            auth2.disconnect();
            });
        }


 
    paypal.Buttons({
    style: {
        shape: 'rect',
        color: 'gold',
        layout: 'vertical',
        label: 'paypal',
        
    },

    createOrder: function(data, actions) {
        return actions.order.create({
        purchase_units: [{"amount"
            :{"currency_code":"USD","value":231}}]
        });
    },

    onApprove: function(data, actions) {
        return actions.order.capture().then(function(orderData) {
        
        // Full available details
        console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
        console.log(typeof(orderData))
        var paymentData = JSON.stringify(orderData, null, 2)
        // Show a success message within this page, e.g.
        const element = document.getElementById('paypal-button-container');
        element.innerHTML = '';
        element.innerHTML = '<h3>Thank you for your payment!</h3>';
        
        const request = new XMLHttpRequest()
        request.open('POST', 'http://127.0.0.1:5005/processPayment/paymentData')
        request.setRequestHeader('Access-Control-Allow-Origin', '*');
        request.setRequestHeader('Access-Control-Allow-Methods', '*');
        request.setRequestHeader('Access-Control-Allow-Headers', 'Content-Type');
        request.setRequestHeader('Content-Type', 'application/json');
        request.onload = () => {
            const flaskMessage = request.responseText
            console.log(flaskMessage)
        }
        request.send(paymentData)

        });
    },

    onError: function(err) {
        console.log(err);
    }
    }).render('#paypal-button-container');

</script>
</body>

</html>