<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESD Airline</title>
    <!-- load stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
    <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css"> <!-- Font Awesome -->
    <link rel="stylesheet" href="css/bootstrap.min.css"> <!-- Bootstrap style -->
    <link rel="stylesheet" type="text/css" href="css/datepicker.css" />
    <link rel="stylesheet" href="css/templatemo-style.css"> <!-- Templatemo style -->
    <link rel="stylesheet" href="css/bookingform.css">
    <link rel="stylesheet" href=" https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css">
    <!-- Bootstrap style -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Google -->
    <meta name = "google-signin-client_id" content="648525575446-vn5s4huqmidti2blbgbg0emnb0ml7887.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!-- js file -->
    <!-- <script src="js/mybookingprocess.js"></script> -->
</head>

<body onload="retriveBooking()">
    <div class="tm-main-content" id="top">
        <div class="tm-top-bar-bg"></div>
        <div class="tm-top-bar" id="tm-top-bar">
            <div class="container">
                <div class="row">
                    <nav class="navbar navbar-expand-lg narbar-light">
                        <a class="navbar-brand mr-auto" href="./index.html">
                            <img src="img/logo.png" alt="Site logo">
                            ESD Airline
                        </a>
                        <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse"
                            data-target="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                            <ul class="navbar-nav ml-auto">
                                <li class="nav-item">
                                    <a class="nav-link" href="./index.html">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link active" href="mybooking.html">My booking</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Recommended Places</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Contact Us</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id = "gbutton"><div class="g-signin2" data-onsuccess="onSignIn"></div></a>
                                </li>
                                <!-- <li class="nav-item">
                                    <a class="nav-link" id="email"></a>
                                </li> -->
                            </ul>
                        </div>
                    </nav>
                </div> <!-- row -->
            </div> <!-- container -->
        </div> <!-- .tm-top-bar -->


        <!-- ---booking history--- -->

        <div class="container d-lg-flex mt-5">
            <div class="box-3">
                <div class="box-inner-2">
                    <div>
                        <p class="fw-bold">All Booking</p>
                        <p id="message"></p>
                    </div>
                    <div class="row" id="info">
                    </div>
                </div>
                
            </div>
           

            
        </div>


        <footer class="tm-container-outer">
            <p class="mb-0">Done by ESD Team 7</p>
        </footer>
    </div>
<script>
    // google sign in 
$(window).on("scroll", function () {
    if ($(window).scrollTop() > 100) {
        $(".tm-top-bar").addClass("active");
    } else {
        $(".tm-top-bar").removeClass("active");
    }
});

function onSignIn(googleUser) {
    var profile = googleUser.getBasicProfile();
    var element = document.querySelector('#gbutton')
    element.innerHTML = '<a href = "mybooking.html" onclick="signOut()">Sign out</a>';

    // var element = document.getElementById('email')
    // element.innerText = profile.getEmail()
    // var email = document.getElementById('email').innerText
    }

function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
        console.log('User signed out.');
        auth2.disconnect();
        });
    }

// booking history
function retriveBooking(){
email = "wyf102@gmail.com";
console.log("email", email)
const get_all_bookings_URL = "http://localhost:5001/booking";
const response = 
fetch(`${get_all_bookings_URL}/${email}`)
        .then(response => response.json())
        .then(data => {
            console.log(response);
            if (data.code === 404) {
                // no booking in db
                document.getElementById('message').innerText = 'No Past Booking'
                booking = [];
            } else {
                booking_obj = data.data.bookings;
                console.log("data",data);
                console.log("booking", booking_obj);
                
            }
            
            let info = document.getElementById("info");
            var str = '';
            for (let i=0;i<booking_obj.length;i++){
                str += `<div class="col-sm">`
                let lastname = booking_obj[i].lastname 
                let firstname = booking_obj[i].lastname
                let passport = booking_obj[i].passport
                let email = booking_obj[i].email
                let phone = booking_obj[i].phone
                let flightNumber = booking_obj[i].flightNumber
                let departureDate = booking_obj[i].departureDate
                let departureCity = booking_obj[i].departureCity       
                let arrivalCity = booking_obj[i].arrivalCity
                // let flightClass = booking_obj[i].flightClass         

                str += `<p>Booking ${i+1}</p>
                    <p>Last Name: ${lastname}</p>
                    <p>First Name: ${firstname}</p>
                    <p>Passport: ${passport}</p>
                    <p>Email: ${email}</p>
                    <p>Phone: ${phone}</p>
                    <p>Flight Number: ${flightNumber}</p>
                    <p>Departure Date: ${departureDate}</p>
                    <p>Departure City: ${departureCity}</p>
                    <p>Arrival City: ${arrivalCity}</p>
                </div>`
                info.innerHTML = str;
            }
        
        })
        .catch(error => {
            // Errors when calling the service; such as network error, 
            // service offline, etc
            console.log(error);
        });
}

</script>


</body>

</html>