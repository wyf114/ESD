<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESD Airline</title>
    <!-- load stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
    <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css"> <!-- Font Awesome -->
    <link rel="stylesheet" href="css/bootstrap.min.css"> <!-- Bootstrap style -->
    <link rel="stylesheet" type="text/css" href="css/datepicker.css" />
    <link rel="stylesheet" href="css/templatemo-style.css"> <!-- Templatemo style -->
    <link rel="stylesheet" href="css/bookingform.css">
    <link rel="stylesheet" href="css/bookingdetails.css">
    <link rel="stylesheet" href=" https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://www.webnots.com/resources/font-awesome/css/font-awesome.min.css">
    <!-- Bootstrap style -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Google -->
    <meta name="google-signin-client_id"
        content="648525575446-vn5s4huqmidti2blbgbg0emnb0ml7887.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!-- js file -->
    <!-- <script src="js/mybookingprocess.js"></script> -->
</head>

<body onload="retriveBooking()">
    <div class="tm-main-content" id="top">
        <div class="tm-top-bar-bg"></div>
        <div class="tm-top-bar" id="tm-top-bar">
            <div class="container">
                <div class="row">
                    <nav class="navbar navbar-expand-lg narbar-light">
                        <a class="navbar-brand mr-auto" href="./index.html">
                            <img src="img/logo.png" alt="Site logo">
                            ESD Airline
                        </a>
                        <button type="button" id="nav-toggle" class="navbar-toggler collapsed" data-toggle="collapse"
                            data-target="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div id="mainNav" class="collapse navbar-collapse tm-bg-white">
                            <ul class="navbar-nav ml-auto">
                                <li class="nav-item">
                                    <a class="nav-link" href="./index.html">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link active" href="mybooking.html">My booking</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Contact Us</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="gbutton">
                                        <div class="g-signin2" data-onsuccess="onSignIn"></div>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="emailTxt" style="display: none"></a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div> <!-- row -->
            </div> <!-- container -->
        </div> <!-- .tm-top-bar -->


        <!-- ---booking history--- -->

        <div class="container d-lg-flex mt-5">
            <div class="box-3">
                <div class="box-inner-2">
                    <div>
                        <!-- <p class="fw-bold"></p>Your Booking Details</p> -->
                        <p id="message"></p>
                    </div>
                    <div class="row" id="info">
                    </div>

                </div>

                <div class="webnots-tip webnots-notification-box">
                    Your Booking Details - [booking id here]
                </div>

                <table class="styled-table" style="width:100%">
                    <thead>
                        <tr>
                            <th>Flight</th>
                            <th>Departs</th>
                            <th>Arrives</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="active-row">
                            <td>1. Singapore to London</td>
                        </tr>

                        <tr>
                            <td>Flight Number: AR425</td>
                            <td>SIN 10:35</td>
                            <td>LHR 14:55</td>
                        </tr>

                        <tr class="active-row">
                            <td>2. London to Singapore</td>
                        </tr>

                        <tr>
                            <td>Flight Number: AR425</td>
                            <td>SIN 10:35</td>
                            <td>LHR 14:55</td>
                        </tr>

                    </tbody>
                </table>
            </div>


        </div>



    </div>


    <footer class="tm-container-outer">
        <p class="mb-0">Done by ESD Team 7</p>
    </footer>
    </div>
    <script>
        // google sign in 
        $(window).on("scroll", function () {
            if ($(window).scrollTop() > 100) {
                $(".tm-top-bar").addClass("active");
            } else {
                $(".tm-top-bar").removeClass("active");
            }
        });

        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            var element = document.querySelector('#gbutton')
            element.innerHTML = '<a href = "mybooking.html" onclick="signOut()">Sign out</a>';
            // ---------don't delete this part!!------
            var emailTxt = document.getElementById('emailTxt');
            emailTxt.innerHTML = profile.getEmail();
            localStorage.setItem("email", profile.getEmail());
            // var element = document.getElementById('email')
            // element.innerText = profile.getEmail()
            // var email = document.getElementById('email').innerText
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
                auth2.disconnect();
            });
        }

        // booking history
        function retriveBooking() {
            let email = localStorage.getItem('email');
            console.log("email", email)
            const get_all_bookings_URL = "http://localhost:5001/booking";
            const response =
                fetch(`${get_all_bookings_URL}/${email}`)
                    .then(response => response.json())
                    .then(data => {

                        console.log(data);
                        if (data.code === 404) {
                            // no booking in db
                            document.getElementById('message').innerText = 'No Past Booking'
                            booking = [];
                        } else {
                            booking_obj = data.data.bookings;
                            console.log("data", data);
                            console.log("booking", booking_obj);

                        }

                        let info = document.getElementById("info");
                        var str = '';
                        for (let i = 0; i < booking_obj.length; i++) {
                            str += `<div class="col-sm">`
                            let lastname = booking_obj[i].lastname
                            let firstname = booking_obj[i].lastname
                            let passport = booking_obj[i].passport
                            let email = booking_obj[i].email
                            let phone = booking_obj[i].phone
                            let flightNumber = booking_obj[i].flightNumber
                            let departureDate = booking_obj[i].departureDate
                            let departureCity = booking_obj[i].departureCity
                            let arrivalCity = booking_obj[i].arrivalCity
                            let departureTime = booking_obj[i].departureTime
                            let arrivalTime = booking_obj[i].arrivalTime
                            let flightNumber2 = booking_obj[i].flightNumber2
                            let departureDate2 = booking_obj[i].departureDate2
                            let departureCity2 = booking_obj[i].departureCity2
                            let arrivalCity2 = booking_obj[i].arrivalCity2
                            let departureTime2 = booking_obj[i].departureTime2
                            let arrivalTime2 = booking_obj[i].arrivalTime2
                            let price = booking_obj[i].price
                            // let flightClass = booking_obj[i].flightClass         

                            str += `<p>Booking ${i + 1}</p>
                    <p>Last Name: ${lastname}</p>
                    <p>First Name: ${firstname}</p>
                    <p>Passport: ${passport}</p>
                    <p>Email: ${email}</p>
                    <p>Phone: ${phone}</p>
                    <p>Flight Number: ${flightNumber}</p>
                    <p>Departure Date: ${departureDate}</p>
                    <p>Departure City: ${departureCity}</p>
                    <p>Arrival City: ${arrivalCity}</p>
                    <p>Departure Time: ${departureTime}</p>
                    <p>Arrival Time: ${arrivalTime}</p></br>
                    <p>Return Flight: </p>
                    <p>Flight Number: ${flightNumber2}</p>
                    <p>Departure Date: ${departureDate2}</p>
                    <p>Departure City: ${departureCity2}</p>
                    <p>Arrival City: ${arrivalCity2}</p>
                    <p>Departure Time: ${departureTime2}</p>
                    <p>Arrival Time: ${arrivalTime2}</p>
                </div>`
                            info.innerHTML = str;
                        }
                    })

                    .catch(error => {
                        // Errors when calling the service; such as network error, 
                        // service offline, etc
                        console.log(error);
                    })
        }

    </script>


</body>

</html>